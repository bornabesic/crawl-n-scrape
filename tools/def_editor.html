<!DOCTYPE html>

<head>
	<style type="text/css">
		html, body {
			font-family: sans-serif;
		}
	</style>
	<script type="text/javascript">
		var proto_categories = [];

		function add_category(){
			var categories = document.getElementById("categories");

			var nameLabel = document.createTextNode("Name: ");
			var name = document.createElement("input");
			name.setAttribute("type", "text");
			name.setAttribute("size", 64);

			var regexesLabel = document.createTextNode("Regexes (one per row): ");
			var regexes = document.createElement("textarea");
			regexes.setAttribute("rows", 5);
			regexes.setAttribute("cols", 64);

			var seedLabel = document.createTextNode("Seed (one per row): ");
			var seed = document.createElement("textarea");
			seed.setAttribute("rows", 5);
			seed.setAttribute("cols", 64);

			var horizontalLine = document.createElement("hr");

			proto_categories.push({
				name: name,
				regexes: regexes,
				seed: seed
			});

			categories.append(nameLabel); categories.append(document.createElement("br"));
			categories.append(name); categories.append(document.createElement("br"));
			categories.append(regexesLabel); categories.append(document.createElement("br"));
			categories.append(regexes); categories.append(document.createElement("br"));
			categories.append(seedLabel); categories.append(document.createElement("br"));
			categories.append(seed); categories.append(document.createElement("br"));
			categories.append(horizontalLine);

			document.getElementById("generate_button").disabled = false;
		}

		function generate_definition(){
			if(document.getElementById("base_url").value == ""){
				alert("Base URL cannot be empty!"); return;
			}

			var categories = [];

			for(var i = 0; i < proto_categories.length; i++){
				var cat = proto_categories[i];

				if(
					cat.name.value == "" ||
					cat.regexes.value == "" ||
					cat.seed.value == ""
				){
					alert("Category fields cannot be empty!"); return;
				}

				categories.push({
					name: cat.name.value,
					regex: cat.regexes.value.split("\n"),
					seed: cat.seed.value.split("\n")
				});

			}

			var final_object = {
				base_url: document.getElementById("base_url").value,
				categories: categories
			};

			var final_json = JSON.stringify(final_object, null, 4);

			var download_link = document.createElement("a");
			download_link.href = window.URL.createObjectURL(
				new Blob(
					[final_json],
					{
						type: 'text/json'
					}
				)
			);
			download_link.download = "def.json";

			download_link.click();
		}
	</script>
</head>

<body>
	<center>
		<h1>Crawl 'n' Scrape Definition Editor</h1>
		<a href = "https://docs.python.org/3/library/re.html">How-To: Python Regular Expressions</a>
	</center>
	Base URL:<br/>
	<input id = "base_url" type = "text" size = "64"></input><br/><br/>
	<button onclick = "add_category()">Add category</button>
	<hr/>
	<div id = "categories">
	</div>
	<button id ="generate_button" onclick = "generate_definition()" disabled>Generate def.json</button>
</body>

</html>